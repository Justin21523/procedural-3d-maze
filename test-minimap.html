<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Minimap Test</title>
  <style>
    body {
      background: #1a1a1a;
      color: #fff;
      font-family: monospace;
      padding: 20px;
    }
    #test-minimap {
      border: 2px solid #ffd700;
      display: block;
      margin: 20px 0;
      background: #000;
    }
    .info {
      background: rgba(255, 255, 255, 0.1);
      padding: 10px;
      margin: 10px 0;
      border-radius: 5px;
    }
  </style>
</head>
<body>
  <h1>Minimap Render Test</h1>
  <div class="info" id="status">Initializing...</div>
  <canvas id="test-minimap" width="200" height="200"></canvas>
  <div class="info" id="grid-info"></div>

  <script type="module">
    import { generateMazeDFS } from './src/world/mapGenerator.js';
    import { TILE_TYPES } from './src/world/tileTypes.js';

    console.log('Starting minimap test...');

    const canvas = document.getElementById('test-minimap');
    const ctx = canvas.getContext('2d');
    const statusDiv = document.getElementById('status');
    const gridInfoDiv = document.getElementById('grid-info');

    // Generate a test maze
    const grid = generateMazeDFS(21, 21);
    const width = grid[0].length;
    const height = grid.length;

    statusDiv.textContent = `Generated ${width}×${height} maze`;
    gridInfoDiv.textContent = `Canvas: ${canvas.width}×${canvas.height}`;

    // Calculate tile size
    const tileSize = Math.floor(Math.min(
      canvas.width / width,
      canvas.height / height
    ));

    const offsetX = (canvas.width - width * tileSize) / 2;
    const offsetY = (canvas.height - height * tileSize) / 2;

    console.log(`Tile size: ${tileSize}px, Offset: ${offsetX}, ${offsetY}`);

    // Clear canvas
    ctx.fillStyle = '#000';
    ctx.fillRect(0, 0, canvas.width, canvas.height);

    // Draw grid
    for (let y = 0; y < height; y++) {
      for (let x = 0; x < width; x++) {
        const px = offsetX + x * tileSize;
        const py = offsetY + y * tileSize;

        if (grid[y][x] === TILE_TYPES.WALL) {
          ctx.fillStyle = '#1a1a1a';
        } else {
          ctx.fillStyle = '#e0e0e0';
        }

        ctx.fillRect(px, py, tileSize, tileSize);
      }
    }

    // Draw a player marker in the center
    const playerX = Math.floor(width / 2);
    const playerY = Math.floor(height / 2);
    const px = offsetX + playerX * tileSize;
    const py = offsetY + playerY * tileSize;

    ctx.fillStyle = '#32cd32';
    ctx.beginPath();
    ctx.arc(px + tileSize / 2, py + tileSize / 2, tileSize / 2, 0, Math.PI * 2);
    ctx.fill();

    console.log('✅ Minimap test render complete!');
    statusDiv.textContent = '✅ Render complete! If you can see a maze above, the minimap rendering works.';
  </script>
</body>
</html>
