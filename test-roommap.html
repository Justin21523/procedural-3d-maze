<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>RoomMap Test</title>
  <style>
    body {
      margin: 20px;
      font-family: monospace;
      background: #1a1a1a;
      color: #fff;
    }
    #canvas {
      border: 2px solid #ffd700;
      image-rendering: pixelated;
      display: block;
      margin: 20px 0;
    }
    .legend {
      margin: 10px 0;
    }
    .color-box {
      display: inline-block;
      width: 20px;
      height: 20px;
      border: 1px solid #fff;
      margin-right: 5px;
      vertical-align: middle;
    }
  </style>
</head>
<body>
  <h1>RoomMap Color Test</h1>
  <canvas id="canvas" width="500" height="500"></canvas>
  <div class="legend">
    <div><span class="color-box" style="background: #ffeb3b;"></span> Yellow = Corridor</div>
    <div><span class="color-box" style="background: #2196f3;"></span> Blue = Classroom</div>
    <div><span class="color-box" style="background: #ff5722;"></span> Orange = Office</div>
    <div><span class="color-box" style="background: #00bcd4;"></span> Cyan = Bathroom</div>
    <div><span class="color-box" style="background: #9e9e9e;"></span> Gray = Storage</div>
    <div><span class="color-box" style="background: #9c27b0;"></span> Purple = Library</div>
    <div><span class="color-box" style="background: #1a1a1a;"></span> Black = Wall</div>
  </div>
  <div id="info"></div>

  <script type="module">
    import { generateMazeDFS, createRoomMapFromRooms } from './src/world/mapGenerator.js';
    import { TILE_TYPES, ROOM_TYPES } from './src/world/tileTypes.js';

    const canvas = document.getElementById('canvas');
    const ctx = canvas.getContext('2d');
    const info = document.getElementById('info');

    // Generate map
    console.log('Generating map...');
    const result = generateMazeDFS(50, 50);
    const grid = result.grid;
    const rooms = result.rooms;

    console.log('Rooms generated:', rooms.length);
    console.log('Rooms:', rooms);

    // Create room map
    const roomMap = createRoomMapFromRooms(grid, rooms);
    console.log('RoomMap created:', roomMap);

    // Room colors
    const roomColors = {
      [ROOM_TYPES.CORRIDOR]: '#ffeb3b',   // Yellow
      [ROOM_TYPES.CLASSROOM]: '#2196f3',  // Blue
      [ROOM_TYPES.OFFICE]: '#ff5722',     // Orange
      [ROOM_TYPES.BATHROOM]: '#00bcd4',   // Cyan
      [ROOM_TYPES.STORAGE]: '#9e9e9e',    // Gray
      [ROOM_TYPES.LIBRARY]: '#9c27b0',    // Purple
    };

    // Calculate tile size
    const tileSize = Math.floor(canvas.width / grid[0].length);
    console.log('Tile size:', tileSize);

    // Draw map
    const roomTypeCounts = {};
    for (let y = 0; y < grid.length; y++) {
      for (let x = 0; x < grid[0].length; x++) {
        const px = x * tileSize;
        const py = y * tileSize;

        if (grid[y][x] === TILE_TYPES.WALL) {
          ctx.fillStyle = '#1a1a1a'; // Black
        } else {
          const roomType = roomMap[y][x];
          roomTypeCounts[roomType] = (roomTypeCounts[roomType] || 0) + 1;
          ctx.fillStyle = roomColors[roomType] || '#ff0000'; // Red for unknown
        }

        ctx.fillRect(px, py, tileSize, tileSize);
      }
    }

    // Display info
    const typeNames = {
      [ROOM_TYPES.CORRIDOR]: 'Corridor',
      [ROOM_TYPES.CLASSROOM]: 'Classroom',
      [ROOM_TYPES.OFFICE]: 'Office',
      [ROOM_TYPES.BATHROOM]: 'Bathroom',
      [ROOM_TYPES.STORAGE]: 'Storage',
      [ROOM_TYPES.LIBRARY]: 'Library',
    };

    let html = '<h3>Room Type Counts:</h3>';
    for (const [type, count] of Object.entries(roomTypeCounts)) {
      html += `<div>${typeNames[type] || 'Unknown'} (${type}): ${count} tiles</div>`;
    }
    info.innerHTML = html;

    console.log('âœ… Test complete');
    console.log('Room type counts:', roomTypeCounts);
  </script>
</body>
</html>
